import statistics
from operator import itemgetter
import numpy as np
import matplotlib.pyplot as plt
import glob
import seaborn as sns
import pickle
from dateutil import parser
import pandas as pd
from scipy.stats import lognorm
from scipy.stats import alpha
from scipy.stats import fisk
from scipy.stats import genextreme
from scipy.stats import gengamma
from scipy.stats import loglaplace
from scipy.stats import burr
from scipy.stats import maxwell
from scipy.stats import mielke
from scipy.stats import moyal
from scipy.stats import nakagami
from scipy.stats import norminvgauss
from scipy.stats import powerlognorm
from scipy.stats import wald
from scipy.stats import cauchy
from mpl_toolkits import mplot3d
from pylab import *

from matplotlib.lines import Line2D

#col_list = ['computation time', 'checkpoint time', 'waste time', 'restart time', 'wallclock time', 'efficiency',
#             'no. of failures', 'no. of checkpoints', 'checkpoint interval', 'pct. of checkpoints to BB', 'daily write workloads to Burst Buffers']
pckpt_ckpt_simulation_data_18_82_0 = [
[5.8110185300682184,4.265984862976939,0.67323936507942,97.10541390721761,20.71,602.648,0.6094073410046552,6199.467183491792],
[1.9652351436750768,0.019896104443052804,0.07177344999994707,99.15106228466135,9.538,578.715,0.4282012121097832,2113.1586040935567],
[0.7080714547619176,0.007298676167597188,0.0031939047618858756,99.70179396203544,3.144,524.48,0.4718580578631701,261.19375008530943],
[0.035153620192155705,0.0005400140600088821,0.0038988095238089164,99.96704369201274,0.393,668.889,0.18454353808265733,6.524755930231187],
[0.0927916941480596,0.0021623654724194966,0.008867283950609846,99.9783796159642,1.547,3391.014,0.14717995649704207,4.303199687233374],
[0.02219144581839928,0.0015392485862614506,0.00024855376343502347,99.99666983786372,1.114,12894.531,0.05948615671587763,0.3483571366730293]
]

pckpt_ckpt_simulation_data_18_779_41 = [
[5.8139176019900285,4.407683458056886,0.675547428571479,97.06697538752044,20.781,602.696,0.6097471616565031,6198.841209773021],
[1.9629524587240788,0.11870356738573679,0.07110372499994817,99.11187129698156,9.449,578.412,0.42855771222542116,2111.9881461298396],
[0.7076951778485189,0.04448734272917797,0.003270095238075469,99.68654086508313,3.219,524.23,0.47227113363745443,261.0426951229552],
[0.03518512502666635,0.0017612086406002662,0.003680555555554995,99.96618375757731,0.371,669.565,0.18445787025438223,6.531349379615091],
[0.09272730118591456,0.008183807213722829,0.009113756613749191,99.97708823144251,1.59,3388.801,0.14736058365429533,4.300352194896387],
[0.022176724571455544,0.0029091463383957785,0.000262387096767953,99.99647973844453,1.176,12885.335,0.059556853692814965,0.3481070606793548]
]

pckpt_ckpt_simulation_data_18_738_82 = [
[5.820168899200434,4.610420595659247,0.6732068571429093,97.0132228322204,20.709,603.494,0.6086068454790257,6207.689109823499],
[1.9618340104945216,0.24140617447519844,0.07082529999994697,99.06239683960054,9.412,578.591,0.4282285087650387,2112.386249373303],
[0.7075415841557996,0.07707665212725191,0.0031441269841086398,99.67320301798368,3.095,524.438,0.47181848866673437,261.1007238507433],
[0.035089197542967174,0.0035966039505811427,0.003829365079364502,99.96461420291818,0.386,667.76,0.18485214290602808,6.5136493178534],
[0.09284263947437121,0.014558230140905895,0.009325837742496595,99.9756932990138,1.627,3393.324,0.1470723321921255,4.3060310897532075],
[0.022221130417766247,0.004283146338130539,0.00026952688171395854,99.99628177745089,1.208,12912.518,0.059384813529379125,0.34884127719238495]
]


pckpt_ckpt_simulation_data_18_697_123 = [
[5.815187195240706,4.815416460448517,0.6766526984127531,96.95989150182255,20.815,603.051,0.6089948601587029,6202.898524477511],
[1.9608671724500555,0.32055371808832395,0.07093064999994848,99.03043731195721,9.426,578.757,0.4276213908073875,2112.7311864572325],
[0.7077579941301367,0.10773868184059901,0.0032345396825209922,99.66042004680882,3.184,524.626,0.4712235579520529,261.1624850578806],
[0.03516356841994896,0.006297021267973222,0.003918650793650244,99.96223327381192,0.395,669.183,0.18436254527855173,6.52752719059565],
[0.09281046469356129,0.018297360321892022,0.008437389770715753,99.97510664197516,1.472,3393.28,0.14703021520410103,4.305964035794285],
[0.02220669210494846,0.006263668194947593,0.0002726505376279813,99.99600833054927,1.222,12905.808,0.05942120864702459,0.3486589668340788]
]

pckpt_ckpt_simulation_data_18_656_164 = [
[5.817506701179462,4.976677655940855,0.6800010158730702,96.9164909402923,20.918,603.448,0.6084402504098546,6206.275662393503],
[1.9592061098353704,0.42257529110920017,0.07073499999994762,98.98962414898956,9.4,578.869,0.4275801805492109,2112.9438872667247],
[0.7073058331997535,0.14090739689705642,0.0030496507936331628,99.64700777821332,3.002,524.638,0.4711270197468563,261.12029811750125],
[0.035152059359137254,0.006793674466311707,0.0037896825396819636,99.96193682022025,0.382,669.017,0.18443987713377344,6.525861838330654],
[0.09280782432360053,0.02111727872973007,0.008970458553784493,99.97440926891757,1.565,3392.996,0.14708171056668065,4.305559264189485],
[0.022198296611790267,0.007784954738392763,0.00026261021504754854,99.99579963619261,1.177,12905.283,0.05943223830947397,0.34864442572582016]
]

pckpt_ckpt_simulation_data_18_615_205 = [
[5.817133148571963,5.2074830986314495,0.673564444444496,96.85834206548108,20.72,603.195,0.6090213913203995,6203.692305456731],
[1.9565662014018816,0.5376035448331524,0.07167562499994742,98.94348620307923,9.525,578.478,0.4279478620565668,2110.756711915653],
[0.7068860155036993,0.1841644536000818,0.0031227936507749756,99.62928340902677,3.074,524.394,0.4715401472116458,260.95981867164943],
[0.035142809351684706,0.009856583447161131,0.004394841269840573,99.95889655721069,0.443,668.808,0.18458103057915448,6.523536609406825],
[0.09273620040487922,0.030280268753688746,0.008764109347435675,99.97256020153358,1.529,3391.138,0.1472169158487587,4.303108512343611],
[0.02219440152644341,0.010421307659870524,0.0002659569892410564,99.99543363301294,1.192,12903.934,0.059445488110089775,0.34860633275628344]
]

pckpt_ckpt_simulation_data_18_574_246 = [
[5.812729294665766,5.366714570686915,0.6686232380952909,96.81934938242169,20.568,602.944,0.6090715502483092,6201.7938786526765],
[1.9543610613664588,0.6157091938704014,0.06960624999994852,98.91345091741998,9.25,578.496,0.42759286946102676,2110.936820878115],
[0.7068237178557807,0.2206867319609891,0.003245714285695473,99.61419742866575,3.195,524.459,0.4711466815843243,260.9579770190389],
[0.03520211612975266,0.010119768452647797,0.00402777777777718,99.9589332925707,0.406,670.028,0.184099564815926,6.5354497931535995],
[0.09273273941553996,0.03716031435285926,0.008832892416218251,99.97111456899168,1.541,3391.49,0.14713848263366108,4.303488291607505],
[0.022177179278323297,0.011068456398739818,0.0002675188171979319,99.99534594343129,1.199,12895.567,0.05948241064362304,0.34837995904064634]
]

pckpt_ckpt_simulation_data_18_533_287 = [
[5.806443221337576,5.369835516541885,0.6614389841270386,96.8221835507793,20.347,602.161,0.6099237764811063,6196.322095982305],
[1.9495330128526804,0.7321812197913844,0.06968149999994865,98.86807270293609,9.26,577.795,0.4281972749946532,2107.983998906385],
[0.7057587589685326,0.25226153834369697,0.003253841269822458,99.601614455579,3.203,523.802,0.4718260190933667,260.5934951589494],
[0.03520087320406656,0.014540020580147068,0.004166666666666055,99.95514512244223,0.42,670.033,0.18405479380773843,6.535253137593124],
[0.09261920040483619,0.038412032170766656,0.008466049382709033,99.97095421654846,1.477,3387.673,0.1473392263710474,4.298625902628185],
[0.022171990520035805,0.014909562195651014,0.0002730967741871064,99.99481250106771,1.224,12895.546,0.05946763403306878,0.34837804835587777]
]

pckpt_ckpt_simulation_data_18_492_328 = [
[5.818225959416457,5.715197435026368,0.6738895238095768,96.72628262450472,20.73,603.637,0.6081987536384029,6208.7512317059545],
[1.9516066794785716,0.8497571920100954,0.07123917499994753,98.81882973604388,9.467,578.748,0.42721314569437524,2110.916864004594],
[0.7067097647833881,0.30096368123557504,0.0032203174602984425,99.58114858026026,3.17,524.737,0.47075720477754257,261.00069726466796],
[0.03519361994832324,0.011986876930230832,0.003670634920634397,99.95768598397032,0.37,669.987,0.18411344447451633,6.534968522324826],
[0.09277522005718875,0.0456944552527015,0.008815696649023085,99.96933315006609,1.538,3393.757,0.14705544604603338,4.306273893973427],
[0.022182185284409427,0.015154482920830256,0.00027622043010106813,99.99477664509814,1.238,12902.274,0.05946645651598015,0.34855975677599443]
]
##
base_simulation_data_18_82 = [
[5.794301214698997,7.6116271093587855,0.6594560000000532,96.24760336737886,20.286,607.451,0.6093714440215192,6251.914887542364],
[1.904263751377483,2.1001341203350634,0.06894404999994937,98.33414690212773,9.162,575.075,0.4290162944176486,2093.9148846455455],
[0.7002456283697466,0.6976818977257101,0.0030780952380768953,99.42062584461024,3.03,522.148,0.4726944080728682,259.31436648465785],
[0.03504886831132147,0.035520319121530065,0.0037301587301581804,99.93820524454341,0.376,667.723,0.18486097004978821,6.511667886381686],
[0.09257016462765524,0.11387458624050573,0.00921119929452516,99.95510587463042,1.607,3391.486,0.14711815522846042,4.302795422145243],
[0.02212335976684388,0.032836299020699754,0.0002572553763379636,99.992332252799,1.153,12896.586,0.05947550841572288,0.34839665354519883]
]
##
pckpt_ckpt_lm_simulation_data_18_82_0 = [
[4.109061054496284,4.954256693216343,0.33778996825398555,97.46239786896858,10.391,430.681,0.7985846372680248,4689.191157320235],
[1.4139147308668059,0.013181624755035903,0.037263799999972425,99.39431605939482,4.952,424.484,0.5671643906268707,1563.9493541213199],
[0.5240399942355728,0.004872672156363912,0.001685333333323502,99.7796957039272,1.659,388.867,0.625139863779318,193.6982340023926],
[0.025953065571631236,0.00027483102918577853,0.001964285714285424,99.97653695236349,0.198,494.013,0.24557886498621143,4.817341028374737],
[0.07045164778454058,0.001202446033842291,0.0049810405643699734,99.9840407332545,0.869,2576.268,0.18893130657112114,3.269072634048853],
[0.01766860327680949,0.0008775087343093355,0.00014123387096441308,99.99740475199644,0.633,10276.35,0.07149718923495867,0.2776211701884489]
]

pckpt_ckpt_lm_simulation_data_18_779_41 = [
[4.1388902032509,5.243295709283652,0.3566120634920828,97.37409958108046,10.97,433.824,0.7969540994915048,4696.214057046579],
[1.418226282818301,0.13638391810513503,0.0383549249999717,99.34155541354477,5.097,425.774,0.5664541986559788,1565.6480496014756],
[0.5243671040894132,0.05899906013611564,0.0017422222222118284,99.75715870555074,1.715,389.249,0.6243723528503066,193.83546115523197],
[0.025986231695106325,0.0027568001529758098,0.002162698412698081,99.9742825656386,0.218,494.651,0.24523684102053772,4.823554472558124],
[0.07057227363490624,0.008118969931880842,0.004923721340383844,99.98258765380442,0.859,2581.146,0.18860555626951644,3.27525482944163],
[0.01769170938085685,0.0028394867388408206,0.00014792741935126764,99.997128170681,0.663,10290.98,0.07141750049052147,0.27801509338873254]
]

pckpt_ckpt_lm_simulation_data_18_738_82 = [
[4.165854442941738,5.471991683149837,0.36707961904763814,97.30656649602454,11.292,436.636,0.79555667798563,4702.7965770257615],
[1.4224819367449926,0.2816073935740602,0.0397620999999704,99.27973804393172,5.284,427.254,0.5648363640229591,1569.379695650601],
[0.5258300618137508,0.09443060134547744,0.0018113015872905979,99.74188067972098,1.783,390.403,0.6225008824201915,194.38661256551046],
[0.02606005064681785,0.004786744986843137,0.0024107142857139638,99.972326236442,0.243,496.043,0.24453481493424142,4.837259172322137],
[0.07075282263973003,0.018047125158741035,0.00511287477953725,99.98044428606082,0.892,2588.043,0.18807086678687587,3.2839950930889636],
[0.017731747251560723,0.004405543368316513,0.00014190322580306082,99.99690597455543,0.636,10316.709,0.07123908916107358,0.27870968105055055]
]

pckpt_ckpt_lm_simulation_data_18_697_123 = [
[4.181600228849016,5.621018599423143,0.3832360634920836,97.25634322930937,11.789,438.261,0.7929897837681341,4714.594443192695],
[1.4279535710308466,0.4250975199138103,0.04182394999996868,99.21797920160981,5.558,428.895,0.5627832418353746,1574.320554736914],
[0.5272917308377848,0.14996312711056567,0.001849904761893765,99.7183171625346,1.821,391.631,0.6202572456901614,194.92551140635194],
[0.02612267038527105,0.006622657800843539,0.002361111111110743,99.97079063153271,0.238,497.279,0.24389860303008185,4.849363969879731],
[0.07094306896546249,0.022048950123375353,0.005342151675480684,99.97952397012541,0.932,2595.134,0.18757045443131612,3.292946489039972],
[0.017774715899558664,0.007045124221928748,0.00015439784945875913,99.9965317340081,0.692,10342.747,0.07107319988149252,0.2794109821635413]
]

pckpt_ckpt_lm_simulation_data_18_656_164 = [
[4.21060861736204,6.079486735578794,0.3975395555555792,97.1444401823316,12.229,441.361,0.7919646960008647,4718.352136957879],
[1.430692022877359,0.5288725209319733,0.042967749999967816,99.17392385948017,5.71,429.644,0.5623849040130782,1575.6129740571566],
[0.5277570511793429,0.1924104370208916,0.0019758730158615395,99.70053233994007,1.945,391.976,0.6198059684334204,195.0725998210864],
[0.026162423241409306,0.008551861873436433,0.0025099206349202302,99.96903188472146,0.253,498.022,0.24354095449915023,4.856430060403291],
[0.07109554465207199,0.030176620949884356,0.005462522045850713,99.97777525957746,0.953,2601.194,0.1871138029997028,3.300627374404187],
[0.01779383314132811,0.007867023753581002,0.00014145698924399486,99.99641674967779,0.634,10356.656,0.07099113423282537,0.27978834228981103]
]

pckpt_ckpt_lm_simulation_data_18_615_205 = [
[4.243789971454595,6.401310826797007,0.4233183492063744,97.02874848925056,13.022,444.795,0.787774338700194,4738.286096092522],
[1.4390322227744334,0.6939522005713086,0.046233599999965645,99.10180885239167,6.144,432.056,0.5589287894605801,1583.6823230292366],
[0.5304569647421116,0.24149065687806806,0.0019941587301467957,99.67913477156765,1.963,394.15,0.6160243381358713,196.1035268111802],
[0.026260952881057967,0.011984466436088874,0.0024404761904757806,99.96615671664281,0.246,499.979,0.2425107487363619,4.8754376458665005],
[0.07144643328908899,0.033694590509335105,0.0055141093474379435,99.97695942177775,0.962,2614.241,0.18616574761972007,3.317086830602929],
[0.017887017498307168,0.009765205526846727,0.000172916666662581,99.99613585548504,0.775,10407.427,0.07065444474815714,0.281158399901127]
]

pckpt_ckpt_lm_simulation_data_18_574_246 = [
[4.259307095930733,6.386584208600144,0.4288446984127227,97.02528482465715,13.192,446.452,0.787478434532219,4738.92643625703],
[1.4399245686202269,0.819666437464788,0.04651202499996522,99.05004629078275,6.181,432.569,0.5586923567966522,1584.0653065889026],
[0.5307136989869599,0.2821145397143681,0.0021302857142728253,99.6622405799978,2.097,394.373,0.615736237437063,196.17232992121845],
[0.026251229473575336,0.011303481223378107,0.0024603174603170805,99.96671287618723,0.248,499.804,0.2426016661192669,4.873822010532558],
[0.07149143160942432,0.03794991084928759,0.005600088183417062,99.9760466363529,0.977,2616.066,0.18603868656710518,3.3193637712665347],
[0.017888651515107528,0.011235149752394227,0.00016309946236174478,99.99593286176591,0.731,10411.827,0.07062982308069948,0.2812776880925626]
]

pckpt_ckpt_lm_simulation_data_18_533_287 = [
[4.287839202883975,6.740952784590397,0.4518603174603474,96.91881629421147,13.9,449.425,0.7851958085183312,4747.609156410978],
[1.4435756068413943,0.9544768240141294,0.04846099999996463,98.99312277614118,6.44,433.731,0.5574065792710583,1587.2628118608716],
[0.5316581510833471,0.34043394213874845,0.0022166349206218156,99.63775677287097,2.182,395.123,0.6143228729394639,196.52217745167272],
[0.026340656389699058,0.015559181608009261,0.002460317460317087,99.96310443253603,0.248,501.563,0.24172739640349739,4.890864604365617],
[0.0717353330959946,0.04549171687301647,0.005932539682534923,99.97435660368612,1.035,2625.027,0.18538731617343351,3.3307783650146545],
[0.017943745258415356,0.01349194723322373,0.00017760215053349394,99.99560982639647,0.796,10444.114,0.07042057774685188,0.2821489494566231]
]

pckpt_ckpt_lm_simulation_data_18_492_328 = [
[4.298143711214839,6.780743594267464,0.45654146031748877,96.90624594123823,14.044,450.527,0.7842695984789646,4753.231406704032],
[1.4463517563365853,1.0768332771482363,0.04911567499996334,98.9416773412341,6.527,434.476,0.5566296654266605,1589.1547549693607],
[0.5322332914223913,0.38037717338494226,0.0023070476190341837,99.62101005709775,2.271,395.658,0.6134683167314127,196.7482680755258],
[0.026399656286746852,0.01703044410090426,0.0028968253968249683,99.96146878126717,0.292,502.644,0.24118256893985365,4.901132457079231],
[0.07181052609172367,0.05613785531976285,0.006121693121687937,99.97208603563722,1.068,2628.306,0.18514817119911295,3.3348384355194365],
[0.017975441615246782,0.018071365253602797,0.00019790591397381908,99.99496671442415,0.887,10463.342,0.07028722032469935,0.2826673472830087]
]

pckpt_ckpt_simulation_data = [pckpt_ckpt_simulation_data_18_82_0,
                              pckpt_ckpt_simulation_data_18_779_41,
                              pckpt_ckpt_simulation_data_18_738_82,
                              pckpt_ckpt_simulation_data_18_697_123,
                              pckpt_ckpt_simulation_data_18_656_164,
                              pckpt_ckpt_simulation_data_18_615_205,
                              pckpt_ckpt_simulation_data_18_574_246,
                              pckpt_ckpt_simulation_data_18_533_287,
                              pckpt_ckpt_simulation_data_18_492_328]

base_simulation_data = [base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82
                              ]

pckpt_ckpt_lm_simulation_data = [pckpt_ckpt_lm_simulation_data_18_82_0,
                                 pckpt_ckpt_lm_simulation_data_18_779_41,
                                 pckpt_ckpt_lm_simulation_data_18_738_82,
                                 pckpt_ckpt_lm_simulation_data_18_697_123,
                                 pckpt_ckpt_lm_simulation_data_18_656_164,
                                 pckpt_ckpt_lm_simulation_data_18_615_205,
                                 pckpt_ckpt_lm_simulation_data_18_574_246,
                                 pckpt_ckpt_lm_simulation_data_18_533_287,
                                 pckpt_ckpt_lm_simulation_data_18_492_328]

model_data = [ckpt_simulation_data,
              ckpt_lm_simulation_data]

ckpt_time_change = []
recovery_time_change = []
recomputation_time_change = []


fp_tp_fn = ['0%', '5%', '10%', '15%', '20%', '25%', '30%', '35%', '40%']
applications = ['CHIMERA', 'XGC', 'S3D', 'GYRO', 'POP', 'VULCAN']
col_list = ['Checkpoint time', 'Re-compuation waste time', 'Reovery time']
models = ['M2', 'M3']
colors = ['red', 'blue']




def data_clear():
    ckpt_time_change.clear()
    recomputation_time_change.clear()
    recovery_time_change.clear()

axes_index = [0]

legend_elements_1 = [Line2D([0], [0], marker='o', label='Checkpoint', color='black'),
                     Line2D([0], [0], marker='v', label='Recomputation', color='black'),
                     Line2D([0], [0], marker='^', label='Recovery', color='black'),
                     Line2D([0], [0], color='red', label='P1'),
                     Line2D([0], [0], color='blue', label='P2')]


plt.rcParams.update({'font.size': 15, 'font.family':'Times New Roman'})

app_index = 0
for app in applications:
    axe = plt.subplot(111)
    #plt.subplots_adjust(hspace=0.01)
    model_index = 0
    for model in models:
        data_clear()
        prediction_index = 0
        for prediction in fp_tp_fn:
            ckpt_time_change.append(float(base_simulation_data[prediction_index][app_index][0] - model_data[model_index][prediction_index][app_index][0]) / float(base_simulation_data[prediction_index][app_index][0]) * 100)
            recomputation_time_change.append(float(base_simulation_data[prediction_index][app_index][1] - model_data[model_index][prediction_index][app_index][1]) / float(base_simulation_data[prediction_index][app_index][1]) * 100)
            recovery_time_change.append(float(base_simulation_data[prediction_index][app_index][2] - model_data[model_index][prediction_index][app_index][2]) / float(base_simulation_data[prediction_index][app_index][2]) * 100)
            prediction_index += 1
        print(fp_tp_fn, recomputation_time_change, 100 * (recomputation_time_change[0] - recomputation_time_change[-1]) / recomputation_time_change[0] )
        l1, = axe.plot(fp_tp_fn, ckpt_time_change, 'o', color=colors[model_index], linestyle='solid', label = 'Checkpoint Overhead')
        l2, = axe.plot(fp_tp_fn, recomputation_time_change, 'v', color = colors[model_index], linestyle='solid', label = 'Recomputation Overhead')
        l3, = axe.plot(fp_tp_fn, recovery_time_change, '^', color=colors[model_index], linestyle='solid', label = 'Recovery Overhead')
        model_index += 1
    axe.tick_params(axis='x', labelsize=15)
    axe.tick_params(axis='y', labelsize=15)
    axe.set_ylim(0, 130)
    axe.set_yticks([10, 20, 30, 40, 50, 60, 70, 80, 90, 100])
    legend_properties = {'size': '15', 'family': 'Times New Roman', 'weight': 'normal'}
    axe.legend(handles=legend_elements_1, loc='upper center', prop=legend_properties, ncol=3, borderaxespad=0,
               borderpad=0.2)
    plt.xlabel('False Negative Rate (percentage)', fontsize=15)
    plt.ylabel('Overhead Reduction (percentage)', rotation='vertical', fontsize=15)
    plt.savefig(str(applications[app_index]) + '_fnp1p2' + '.png', dpi=400)
    plt.clf()
    app_index += 1

#plt.rcParams.update({'font.size': 12, 'font.family':'Times New Roman'})
