import statistics
from operator import itemgetter
import numpy as np
import matplotlib.pyplot as plt
import glob
import seaborn as sns
import pickle
from dateutil import parser
import pandas as pd
from scipy.stats import lognorm
from scipy.stats import alpha
from scipy.stats import fisk
from scipy.stats import genextreme
from scipy.stats import gengamma
from scipy.stats import loglaplace
from scipy.stats import burr
from scipy.stats import maxwell
from scipy.stats import mielke
from scipy.stats import moyal
from scipy.stats import nakagami
from scipy.stats import norminvgauss
from scipy.stats import powerlognorm
from scipy.stats import wald
from scipy.stats import cauchy
from mpl_toolkits import mplot3d
from pylab import *

from matplotlib.lines import Line2D

#col_list = ['computation time', 'checkpoint time', 'waste time', 'restart time', 'wallclock time', 'efficiency',
#             'no. of failures', 'no. of checkpoints', 'checkpoint interval', 'pct. of checkpoints to BB', 'daily write workloads to Burst Buffers']
old_ckpt_simulation_data_18_82_0 = [
[11.409815311965868,22.806250056505025,0.3384947002793374,91.28297211172257,22.598,303.32,1.2143039009020946,11822.963639192392],
[3.780608989555718,5.271003021983819,0.05922703096028403,96.35690877797745,9.586,289.95,0.8511187678004268,4077.605727256965],
[1.3864544535094347,0.8138922827155038,0.017631267752997958,99.08703398424103,3.14,264.327,0.937471341671109,511.3843291712285],
[0.0697288230354079,0.02208920025786314,0.00011178581371730162,99.92360112589164,0.399,337.124,0.3665216281030983,12.943897611744157],
[0.18561941621198452,0.07823891278940888,0.0002935273319058836,99.9450262417754,1.537,1725.332,0.28861141884961,8.62596980714206],
[0.044394861971479176,0.02099787300416496,4.864492528573239e-05,99.9909130093437,1.229,6561.02,0.11675851811731484,0.6990890394714804]
]

old_ckpt_simulation_data_18_779_41 = [
[11.41606225481015,22.723546309858413,0.33836104208038836,91.30036019051592,22.802,303.469,1.2131992894248016,11826.547311832683],
[3.7845542818383713,5.357650413695701,0.05786407822695693,96.32248356069425,9.664,290.16,0.850379765881835,4080.4425775006525],
[1.3880522937631317,0.9046803950285708,0.01703258269466933,99.04960917283944,3.198,264.55,0.9363700615064536,511.8122578041757],
[0.06971846881761545,0.029460992650295514,0.00010252240653339684,99.91750845767815,0.386,337.042,0.36656493175659266,12.94109431256036],
[0.18578363410611803,0.08504252679385017,0.00027460086631542305,99.94358062053618,1.483,1726.801,0.28830018816855973,8.633589604372371],
[0.044420863765420496,0.02939059781887394,4.423496887123823e-05,99.9897448570383,1.199,6564.786,0.11667460348099974,0.6994923258899562]
]

old_ckpt_simulation_data_18_738_82 = [
[11.425093979404298,23.05821000805322,0.3441348027750149,91.22041838847494,23.021,303.734,1.21221507233276,11831.970743215272],
[3.7901978787460036,5.341551465472985,0.05853957756058413,96.32574096611937,9.695,290.617,0.8488848824749669,4086.9959726897655],
[1.3905284170701797,0.9423787258049583,0.016530720406679557,99.03362227874261,3.178,264.916,0.9349084097514049,512.6092260656575],
[0.06986467037281903,0.03315190883227279,0.00010323973948376871,99.91432332957025,0.404,337.756,0.36570777131595317,12.968592900116667],
[0.18585061347019263,0.09381367245539024,0.0002736658166837956,99.94174466199645,1.564,1727.38,0.2883118898666784,8.636236427558178],
[0.0443836883737448,0.025209771150016453,3.951492528332501e-05,99.99033107321557,1.132,6559.126,0.11687191823791769,0.6989096377842551]
]


old_ckpt_simulation_data_18_697_123 = [
[11.393370046767346,22.330460376359905,0.33321252587870215,91.39823898214232,22.238,302.882,1.215961119649198,11811.79921602995],
[3.776350164111538,5.338909995830274,0.05672756474520728,96.33347977564638,9.645,289.498,0.852378123078267,4072.5503207356614],
[1.3857560597561656,0.9949572739993603,0.01566696317381453,99.0144468412794,3.178,263.861,0.9388131910680281,510.7812929835058],
[0.06971474129921297,0.031961915187512756,9.326090461628426e-05,99.91545602238098,0.376,336.984,0.36663019857027807,12.939788169041742],
[0.18521732466004995,0.09048340635063819,0.00025725403776110804,99.94257068701101,1.502,1721.373,0.2893416916585407,8.606913425473675],
[0.04429862420212959,0.03199017765694606,4.015112079971086e-05,99.9894014482151,1.179,6546.605,0.11701367496893622,0.697563892503148]
]

old_ckpt_simulation_data_18_656_164 = [
[11.353141240137607,21.99423422935588,0.3237168084664054,91.4861395432577,21.859,301.788,1.2210111107710506,11777.544587067781],
[3.769256476331797,5.259464346643574,0.05477421014860467,96.36748281118854,9.448,288.913,0.8544959120940374,4065.965804047787],
[1.3835709338463136,0.9813867904091352,0.014681564219046702,99.02119452162985,3.027,263.336,0.9408932591924877,509.96069039940966],
[0.06945505751702774,0.028023951720191228,9.050493618940574e-05,99.91892307498645,0.359,335.742,0.368242126271983,12.893061904546377],
[0.1847196098359767,0.1055791050567151,0.0002464432724471198,99.93953836876375,1.533,1716.668,0.29020703027639566,8.583525618249055],
[0.04420914744068216,0.03544700259314361,3.529670610424919e-05,99.98893470158684,1.143,6533.291,0.117213203770779,0.6961509316442496]
]

old_ckpt_simulation_data_18_615_205 = [
[11.40383179442222,22.63614432567112,0.3349844086809851,91.32333842625714,22.567,303.134,1.2148963519757348,11819.575144343045],
[3.783456915772992,5.416566245406838,0.05613440226667331,96.30057892483282,9.64,290.017,0.850727744820615,4079.239596745428],
[1.3888194687193745,1.0167260286533084,0.015149228300522996,99.00448659103868,3.156,264.336,0.9367431240130583,511.85717630905043],
[0.06974228351853545,0.03926482046644962,9.335140478929062e-05,99.90936709669154,0.395,337.123,0.36640284168938464,12.94455706424917],
[0.18557074310501664,0.12540355029770123,0.0002470944914102667,99.93523914581999,1.618,1724.596,0.2887885691034511,8.622887805496793],
[0.04436746601569635,0.036320520442322285,3.5420740971606524e-05,99.98879138264019,1.191,6556.679,0.11685936348810881,0.6986427165670794]
]

old_ckpt_simulation_data_18_574_246 = [
[11.420841542407869,22.549100295291122,0.33466701009615624,91.34029646792447,22.583,303.578,1.2129553529697958,11838.023263457386],
[3.7914912030373302,5.510479189627879,0.05706976063659616,96.2610858289984,9.856,290.612,0.8489427399469179,4086.2633034949195],
[1.39148077218828,1.1026176137878132,0.014481858236707307,98.96885566369373,3.18,264.742,0.9349678389265982,512.6697006938801],
[0.06976526988203217,0.049422003349721466,8.81109684545921e-05,99.90094312812904,0.418,337.192,0.3664401326516372,12.947775696734354],
[0.18578934135101371,0.12307838517545179,0.00021982287364806142,99.93568209531217,1.508,1726.5,0.28845554934215845,8.63292938260299],
[0.044441024968874754,0.041037073015488375,3.586261519249523e-05,99.98812624715514,1.279,6567.551,0.11666208867956891,0.6997997121090761]
]

old_ckpt_simulation_data_18_533_287 = [
[11.426561634650827,23.044430946497357,0.33977757323571,91.2254673941564,22.992,303.744,1.2122400661830177,11835.478818924821],
[3.787820252271027,5.471738197913492,0.05503181597244649,96.27914210187375,9.699,290.286,0.8500582312710052,4083.2887007575405],
[1.3908405779144448,1.1580049531652796,0.013944931964825422,98.94679839431187,3.251,264.446,0.9359458555300737,512.2838435971601],
[0.06993735698171022,0.04744503098225149,9.16385699356611e-05,99.90242849200779,0.415,338.067,0.36547589959379917,12.980545345545078],
[0.1859300841625296,0.13482319831027065,0.00021184245714730946,99.93321419793432,1.543,1727.744,0.28817530427471877,8.639139366556714],
[0.04439939638106892,0.04072550651089221,3.1027322539238014e-05,99.98817603968544,1.184,6561.254,0.1168162759242475,0.6991386599373405]
]

old_ckpt_simulation_data_18_492_328 = [
[11.399805150540683,22.862387564160805,0.33515927023041453,91.27292184384646,22.762,303.01,1.2153775666244766,11812.47565760951],
[3.7829212966220322,5.4975117292234765,0.05413445261253007,96.27091908429216,9.652,289.894,0.8511687277766751,4077.2208159235006],
[1.3886766154516648,1.18617645690748,0.013293578782540632,98.93649636512785,3.157,264.018,0.9375777144493663,511.48462600534737],
[0.06972302467344414,0.049844287842172874,7.570006051632289e-05,99.90062884691292,0.389,336.958,0.3666049573565436,12.939920880348243],
[0.185597556387395,0.14661449178089397,0.00019956611758809053,99.93083369394189,1.547,1724.572,0.28874219524572997,8.623606163639918],
[0.0443240304317226,0.045051772358657496,2.7399819425493106e-05,99.98758636784736,1.158,6550.059,0.11702655795360244,0.6979501710040895]
]

##
base_simulation_data_18_82 = [
[11.447485129960521,18.194730735708085,0.2856488169363588,92.35789430987482,19.88,304.194,1.2149231711173074,11956.012844761666],
[3.790145623219088,4.598792098637482,0.046692926081644,96.61691371042058,9.361,290.124,0.8499282268738121,4098.872317410617],
[1.3943484192661018,1.5030231427404552,0.0064058868352723465,98.80876983731434,3.171,263.539,0.9362942751438986,512.7951546334012],
[0.06987937336208186,0.07683671149923899,3.376228033768097e-05,99.8781715211206,0.427,337.444,0.3660572780373517,12.964446009099847],
[0.18519255737117998,0.22000672379400074,6.294807171279631e-05,99.91569240049574,1.531,1719.78,0.28968985527691676,8.60294086560089],
[0.04423950768176744,0.06855806740160023,9.956895292427326e-06,99.98433747946248,1.16,6536.787,0.11727711586582207,0.6965857231031973]
]
##

old_ckpt_lm_simulation_data_18_82_0 = [
[7.533135690859223,13.027808095552995,0.16033979618676406,94.58929803670866,11.159,200.178,1.874327987916447,7990.410172858694],
[1.971888436185691,2.779846390904923,0.01562749037643317,98.06544616582941,3.133,150.942,1.6489616304626524,2153.1666666862297],
[0.5013990970922346,0.6574274389620991,0.0009716908129190555,99.5239364207766,0.481,94.767,2.6226949784080005,184.92830743690223],
[0.024208368278592025,0.035153295432868055,5.297594338699696e-06,99.95093569799894,0.067,116.901,1.0641124108843818,4.481018486233752],
[0.06333394215543237,0.0864992209956622,9.251022949310018e-06,99.96884810741186,0.225,588.147,0.8465197269831942,2.941353429429824],
[0.013477402509101163,0.020472806747333344,9.613554075662556e-07,99.99528741327187,0.112,1991.408,0.38189845690884733,0.21218361044327852]
]

old_ckpt_lm_simulation_data_18_779_41 = [
[7.584202567001941,13.617986605992982,0.16743791065188554,94.43111174163742,11.653,201.535,1.8623790325870127,8033.009919928537],
[1.9846649125182545,2.986199904452588,0.017198719060945264,97.97777130039401,3.448,151.92,1.6374671820398772,2165.729594796128],
[0.5045259963966479,0.8244419932512317,0.001321176282014647,99.45404839895734,0.654,95.358,2.604912798282278,185.986837891308],
[0.024452106565379928,0.03444051958359857,4.665045760944397e-06,99.9513403694811,0.059,118.078,1.0529230956859776,4.525912576354128],
[0.06368025346532925,0.1018391094338723,1.0114451757908815e-05,99.96558740819773,0.246,591.363,0.842227336155787,2.9574146226292397],
[0.013544477933200084,0.028015117032917314,1.2961130942038546e-06,99.99423136114707,0.151,2001.319,0.3803580513036042,0.21323589238861776]
]

old_ckpt_lm_simulation_data_18_738_82 = [
[7.648515972549384,14.419586567743517,0.17700743339230704,94.21594811382815,12.319,203.244,1.8458412251066258,8087.311527995878],
[2.000681231520013,3.3391843373156296,0.01874500760760799,97.83162370239043,3.758,153.146,1.6234318759768913,2180.646391658601],
[0.5089756111428653,0.9452251766298437,0.0014686470290894771,99.40327463090799,0.727,96.199,2.582163017412024,187.48628657787168],
[0.024548607875187492,0.0504225115320671,7.116171499745083e-06,99.93807750367,0.09,118.544,1.048500805823656,4.543939563480857],
[0.06431117323041924,0.16349004350345053,1.5911759472797772e-05,99.95265324662911,0.387,597.222,0.8335612909099883,2.986326148034237],
[0.013685051400628664,0.04610351292854872,1.965628466880087e-06,99.99170166827817,0.229,2022.09,0.3765010713732931,0.21544580929815255]
]

old_ckpt_lm_simulation_data_18_697_123 = [
[7.691567193114821,14.684416556572453,0.18163413958212005,94.1394053428407,12.641,204.388,1.834885122383149,8126.108378784171],
[2.0130657914006536,3.567691507377754,0.02033120037482973,97.73534659287934,4.076,154.094,1.6129693742995255,2191.7664055203936],
[0.5119755297648698,1.1528657793849741,0.0017918705843225314,99.31795825989911,0.887,96.766,2.56587435447558,188.45000673226266],
[0.024664989283153617,0.048217178300293,8.144062938597151e-06,99.93981610821344,0.103,119.106,1.043182870731084,4.565698340098779],
[0.06462905599994807,0.18144591831065296,1.7433038802236456e-05,99.94886426240018,0.424,600.174,0.8297902389742218,3.000926255009289],
[0.013748837685795854,0.05838075006353553,2.626560309821113e-06,99.98998883748442,0.306,2031.515,0.375040117607655,0.2164466024896069]
]

old_ckpt_lm_simulation_data_18_656_164 = [
[7.742220115213628,15.77424445204813,0.19381875712548327,93.86027118902243,13.489,205.734,1.8225441475289306,8163.169754056448],
[2.0294478990908744,3.8217393483856568,0.021608135432718934,97.62825858483082,4.332,155.348,1.5990820778626105,2208.092428732632],
[0.5161711831462589,1.3168399238653503,0.002056509870169518,99.24933005527848,1.018,97.559,2.5432646306918936,189.8984242119933],
[0.024916182606749673,0.06385546797467345,9.330091521888684e-06,99.92669528389203,0.118,120.319,1.0318979382813738,4.61233997121472],
[0.06512752461109729,0.18889476888993137,2.0146672200695327e-05,99.94720797204471,0.49,604.803,0.8233570015023368,3.024036892633023],
[0.013844506961903537,0.06646860479041865,3.072903891791656e-06,99.98885335092655,0.358,2045.651,0.3726455665159903,0.2179519239535645]
]

old_ckpt_lm_simulation_data_18_615_205 = [
[7.788018485343102,16.44766558361929,0.20356070369906304,93.6827534313873,14.167,206.951,1.8110249812919916,8202.901123940068],
[2.038997596635971,4.02971506414653,0.02324420847563949,97.54164547175519,4.66,156.079,1.5918860148412943,2216.486134073835],
[0.5185996886974031,1.4559392352106242,0.0022726656227314576,99.19187186274368,1.125,98.018,2.5315935280963675,190.65964227390728],
[0.02504436782299728,0.08239604111739313,1.2255628694006315e-05,99.91131048503118,0.155,120.938,1.0268376204545913,4.634864163919951],
[0.06549935699697387,0.2165361479844513,2.14212575848467e-05,99.94138785816006,0.521,608.256,0.8187557595772581,3.0411675137371352],
[0.013901877395811325,0.06876230137811741,3.1673227265263113e-06,99.98852633235697,0.369,2054.128,0.3714745188680824,0.2188558287727621]
]

old_ckpt_lm_simulation_data_18_574_246 = [
[7.816920004044351,16.66913007505662,0.207641401083867,93.61999515529111,14.451,207.719,1.804728211892207,8225.023811520181],
[2.048743252407023,4.267866601984929,0.02476056885688292,97.44400211713126,4.964,156.825,1.5835565380948484,2225.550397858299],
[0.5211075571750559,1.5920510812263435,0.0025393250557985115,99.13603633415369,1.257,98.492,2.5186402962329435,191.50408670254075],
[0.025184771016235747,0.0748128066616623,1.146494297181222e-05,99.91748206836462,0.145,121.616,1.020252843116343,4.660704440127794],
[0.06571709377204288,0.2596684108055762,2.6314020833566598e-05,99.93238345876212,0.64,610.278,0.8163102997036986,3.0511149664025687],
[0.013954726955589726,0.07492930458788141,3.5278310045790408e-06,99.98766382925656,0.411,2061.937,0.37021390203030374,0.21968114093313093]
]

old_ckpt_lm_simulation_data_18_533_287 = [
[7.867798719258014,17.290105517304983,0.21780003858759495,93.4566660057901,15.158,209.071,1.7924638217249291,8264.908435471505],
[2.0651514878606982,4.561284712133136,0.026720863691845644,97.32227554940104,5.357,158.081,1.5704459359070049,2240.8785755517133],
[0.5247370883473584,1.7943865213845938,0.00290901199709615,99.05228058337991,1.44,99.178,2.4987246434552532,192.70108922870816],
[0.02528127232604265,0.08508054144168063,1.407420585505248e-05,99.90891422155212,0.178,122.082,1.0167512574453121,4.67869318969999],
[0.06615192121898304,0.2584565307869775,2.6889640039308716e-05,99.93254051031516,0.654,614.316,0.8110522317270763,3.0712700778557074],
[0.014036562898300502,0.08381590021282426,4.120094603697388e-06,99.98641879475046,0.48,2074.029,0.36836081388700664,0.22096953846953185]
]

old_ckpt_lm_simulation_data_18_492_328 = [
[7.893764927466184,17.757594003425467,0.2217657867502912,93.34001351031146,15.434,209.761,1.7861997672615328,8284.911818668534],
[2.0712784483923667,4.977021667066771,0.028701110637087864,97.15716808940614,5.754,158.55,1.5655040399208089,2244.118128236893],
[0.5265888899658775,1.9730489732728875,0.003100925983015801,98.97931479873934,1.535,99.528,2.490242520931315,193.2856574380258],
[0.02542208968799484,0.09536574064529786,1.5497440155000542e-05,99.90028543256953,0.196,122.762,1.0108455102014455,4.704340618986001],
[0.06645171309916209,0.306525046564351,3.211132854845589e-05,99.92250227739213,0.781,617.1,0.8069213606169726,3.0849421365483303],
[0.014117018214919846,0.10700874245328461,4.9441135243394884e-06,99.98318922965758,0.576,2085.917,0.3660524133242682,0.22223038754419752]
]

ckpt_simulation_data = [old_ckpt_simulation_data_18_82_0,
                        old_ckpt_simulation_data_18_779_41,
                        old_ckpt_simulation_data_18_738_82,
                        old_ckpt_simulation_data_18_697_123,
                        old_ckpt_simulation_data_18_656_164,
                        old_ckpt_simulation_data_18_615_205,
                        old_ckpt_simulation_data_18_574_246,
                        old_ckpt_simulation_data_18_533_287,
                        old_ckpt_simulation_data_18_492_328]

base_simulation_data = [base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82,
                              base_simulation_data_18_82
                              ]

ckpt_lm_simulation_data = [old_ckpt_lm_simulation_data_18_82_0,
                           old_ckpt_lm_simulation_data_18_779_41,
                           old_ckpt_lm_simulation_data_18_738_82,
                           old_ckpt_lm_simulation_data_18_697_123,
                           old_ckpt_lm_simulation_data_18_656_164,
                           old_ckpt_lm_simulation_data_18_615_205,
                           old_ckpt_lm_simulation_data_18_574_246,
                           old_ckpt_lm_simulation_data_18_533_287,
                           old_ckpt_lm_simulation_data_18_492_328]

model_data = [ckpt_simulation_data,
              ckpt_lm_simulation_data]

ckpt_time_change = []
recovery_time_change = []
recomputation_time_change = []


fp_tp_fn = ['0%', '5%', '10%', '15%', '20%', '25%', '30%', '35%', '40%']
applications = ['CHIMERA', 'XGC', 'S3D', 'GYRO', 'POP', 'VULCAN']
col_list = ['Checkpoint time', 'Re-compuation waste time', 'Reovery time']
models = ['M1', 'M2']
colors = ['red', 'blue']




def data_clear():
    ckpt_time_change.clear()
    recomputation_time_change.clear()
    recovery_time_change.clear()

axes_index = [0]

legend_elements_1 = [Line2D([0], [0], marker='o', label='Checkpoint', color='black'),
                     Line2D([0], [0], marker='v', label='Recomputation', color='black'),
                     Line2D([0], [0], marker='^', label='Recovery', color='black'),
                     Line2D([0], [0], color='red', label='M1'),
                     Line2D([0], [0], color='blue', label='M2')]


plt.rcParams.update({'font.size': 15, 'font.family':'Times New Roman'})

app_index = 0
for app in applications:
    axe = plt.subplot(111)
    #plt.subplots_adjust(hspace=0.01)
    model_index = 0
    for model in models:
        data_clear()
        prediction_index = 0
        for prediction in fp_tp_fn:
            ckpt_time_change.append(float(base_simulation_data[prediction_index][app_index][0] - model_data[model_index][prediction_index][app_index][0]) / float(base_simulation_data[prediction_index][app_index][0]) * 100)
            recomputation_time_change.append(float(base_simulation_data[prediction_index][app_index][1] - model_data[model_index][prediction_index][app_index][1]) / float(base_simulation_data[prediction_index][app_index][1]) * 100)
            recovery_time_change.append(float(base_simulation_data[prediction_index][app_index][2] - model_data[model_index][prediction_index][app_index][2]) / float(base_simulation_data[prediction_index][app_index][2]) * 100)
            prediction_index += 1
        print(models[model_index], fp_tp_fn, recomputation_time_change, 100 * (recomputation_time_change[0] - recomputation_time_change[-1]) / recomputation_time_change[0] )
        l1, = axe.plot(fp_tp_fn, ckpt_time_change, 'o', color=colors[model_index], linestyle='solid', label = 'Checkpoint Overhead')
        l2, = axe.plot(fp_tp_fn, recomputation_time_change, 'v', color = colors[model_index], linestyle='solid', label = 'Recomputation Overhead')
        l3, = axe.plot(fp_tp_fn, recovery_time_change, '^', color=colors[model_index], linestyle='solid', label = 'Recovery Overhead')
        model_index += 1
    axe.tick_params(axis='x', labelsize=15)
    axe.tick_params(axis='y', labelsize=15)
    axe.set_ylim(0, 130)
    axe.set_yticks([10, 20, 30, 40, 50, 60, 70, 80, 90, 100])
    legend_properties = {'size': '15', 'family': 'Times New Roman', 'weight': 'normal'}
    axe.legend(handles=legend_elements_1, loc='upper center', prop=legend_properties, ncol=3, borderaxespad=0,
               borderpad=0.2)
    plt.xlabel('False Negative Rate (percentage)', fontsize=15)
    plt.ylabel('Overhead Reduction (percentage)', rotation='vertical', fontsize=15)
    plt.savefig(str(applications[app_index]) + '_fnm1m2' + '.png', dpi=400)
    plt.clf()
    app_index += 1

#plt.rcParams.update({'font.size': 12, 'font.family':'Times New Roman'})
